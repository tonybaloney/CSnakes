
name: Docs CI
permissions:
  contents: read
  models: read

on:
  push:
    branches: ["main"]
    paths:
      - "docs/**"
      - ".github/workflows/docs-ci.yml"
      - "mkdocs.yml"
  pull_request:
    branches: ["main"]
    paths:
      - "docs/**"
      - ".github/workflows/docs-ci.yml"
      - "mkdocs.yml"

jobs:
  validate-docs:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v5
        with:
          fetch-depth: 0
      - name: Setup Python
        id: installpython
        uses: actions/setup-python@v5
        with:
          python-version: "3.13"
      - name: Install LLM with GitHub Models
        run: python -m pip install llm-github-models
      - name: Review docs changes
        run: | 
          git --no-pager diff -p --no-color -U0 origin/main...${{ github.sha }} docs | llm prompt -m github/gpt-5-nano \
          "For each of the added lines in this output from git diff (those starting +), review grammatical \
          or spelling mistakes and print out the fixes. Only report spelling, punctuation and grammatical errors. \
          Use the formatting for GitHub Actions, e.g. \
              ::warning file=app.py,line=10,col=5::Code formatting issues detected"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Build HTML with mkdocs (strict)
        run: |
          python -m pip install -r docs/requirements.txt
          python -m mkdocs build -s

