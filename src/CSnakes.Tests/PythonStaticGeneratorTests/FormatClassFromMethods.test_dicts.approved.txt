// <auto-generated/>
#nullable enable

using CSnakes.Runtime;
using CSnakes.Runtime.Python;

using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Reflection.Metadata;
using System.Threading.Tasks;

using Microsoft.Extensions.Logging;

[assembly: MetadataUpdateHandler(typeof(Python.Generated.Tests.TestClassExtensions))]

namespace Python.Generated.Tests;

public static class TestClassExtensions
{
    private static ITestClass? instance;

    private static ReadOnlySpan<byte> HotReloadHash => "8ea19c310b3c17facca0535bed6b4ec2"u8;

    public static ITestClass TestClass(this IPythonEnvironment env)
    {
        if (instance is null)
        {
            instance = new TestClassInternal(env.Logger);
        }
        Debug.Assert(!env.IsDisposed());
        return instance;
    }

    public static void UpdateApplication(Type[]? updatedTypes)
    {
        instance?.ReloadModule();
    }

    private class TestClassInternal : ITestClass
    {
        private PyObject module;
        private readonly ILogger<IPythonEnvironment> logger;

        private PyObject __func_test_dict_str_int;
        private PyObject __func_test_dict_str_list_int;
        private PyObject __func_test_dict_str_dict_int;
        private PyObject __func_test_mapping;

        internal TestClassInternal(ILogger<IPythonEnvironment> logger)
        {
            this.logger = logger;
            using (GIL.Acquire())
            {
                logger.LogDebug("Importing module {ModuleName}", "test");
                module = Import.ImportModule("test");
                this.__func_test_dict_str_int = module.GetAttr("test_dict_str_int");
                this.__func_test_dict_str_list_int = module.GetAttr("test_dict_str_list_int");
                this.__func_test_dict_str_dict_int = module.GetAttr("test_dict_str_dict_int");
                this.__func_test_mapping = module.GetAttr("test_mapping");
            }
        }

        void IReloadableModuleImport.ReloadModule()
        {
            logger.LogDebug("Reloading module {ModuleName}", "test");
            using (GIL.Acquire())
            {
                Import.ReloadModule(ref module);
                // Dispose old functions
                this.__func_test_dict_str_int.Dispose();
                this.__func_test_dict_str_list_int.Dispose();
                this.__func_test_dict_str_dict_int.Dispose();
                this.__func_test_mapping.Dispose();
                // Bind to new functions
                this.__func_test_dict_str_int = module.GetAttr("test_dict_str_int");
                this.__func_test_dict_str_list_int = module.GetAttr("test_dict_str_list_int");
                this.__func_test_dict_str_dict_int = module.GetAttr("test_dict_str_dict_int");
                this.__func_test_mapping = module.GetAttr("test_mapping");
            }
        }

        public void Dispose()
        {
            logger.LogDebug("Disposing module {ModuleName}", "test");
            this.__func_test_dict_str_int.Dispose();
            this.__func_test_dict_str_list_int.Dispose();
            this.__func_test_dict_str_dict_int.Dispose();
            this.__func_test_mapping.Dispose();
            module.Dispose();
        }

        public IReadOnlyDictionary<string, long> TestDictStrInt(IReadOnlyDictionary<string, long> a)
        {
            using (GIL.Acquire())
            {
                logger.LogDebug("Invoking Python function: {FunctionName}", "test_dict_str_int");
                PyObject __underlyingPythonFunc = this.__func_test_dict_str_int;
                using PyObject a_pyObject = PyObject.From(a)!;
                using PyObject __result_pyObject = __underlyingPythonFunc.Call(a_pyObject);
                IReadOnlyDictionary<string, long> __return = __result_pyObject.As<IReadOnlyDictionary<string, long>>();
                return __return;
            }
        }

        public IReadOnlyDictionary<string, IReadOnlyList<long>> TestDictStrListInt(IReadOnlyDictionary<string, IReadOnlyList<long>> a)
        {
            using (GIL.Acquire())
            {
                logger.LogDebug("Invoking Python function: {FunctionName}", "test_dict_str_list_int");
                PyObject __underlyingPythonFunc = this.__func_test_dict_str_list_int;
                using PyObject a_pyObject = PyObject.From(a)!;
                using PyObject __result_pyObject = __underlyingPythonFunc.Call(a_pyObject);
                IReadOnlyDictionary<string, IReadOnlyList<long>> __return = __result_pyObject.As<IReadOnlyDictionary<string, IReadOnlyList<long>>>();
                return __return;
            }
        }

        public IReadOnlyDictionary<string, IReadOnlyDictionary<string, long>> TestDictStrDictInt(IReadOnlyDictionary<string, IReadOnlyDictionary<string, long>> a)
        {
            using (GIL.Acquire())
            {
                logger.LogDebug("Invoking Python function: {FunctionName}", "test_dict_str_dict_int");
                PyObject __underlyingPythonFunc = this.__func_test_dict_str_dict_int;
                using PyObject a_pyObject = PyObject.From(a)!;
                using PyObject __result_pyObject = __underlyingPythonFunc.Call(a_pyObject);
                IReadOnlyDictionary<string, IReadOnlyDictionary<string, long>> __return = __result_pyObject.As<IReadOnlyDictionary<string, IReadOnlyDictionary<string, long>>>();
                return __return;
            }
        }

        public IReadOnlyDictionary<string, long> TestMapping(IReadOnlyDictionary<string, long> a)
        {
            using (GIL.Acquire())
            {
                logger.LogDebug("Invoking Python function: {FunctionName}", "test_mapping");
                PyObject __underlyingPythonFunc = this.__func_test_mapping;
                using PyObject a_pyObject = PyObject.From(a)!;
                using PyObject __result_pyObject = __underlyingPythonFunc.Call(a_pyObject);
                IReadOnlyDictionary<string, long> __return = __result_pyObject.As<IReadOnlyDictionary<string, long>>();
                return __return;
            }
        }
    }
}

/// <summary>
/// Represents functions of the Python module <c>test</c>.
/// </summary>
public interface ITestClass : IReloadableModuleImport
{
    /// <summary>
    /// Invokes the Python function <c>test_dict_str_int</c>:
    /// <code><![CDATA[
    /// def test_dict_str_int(a: dict[str, int]) -> dict[str, int]: ...
    /// ]]></code>
    /// </summary>
    IReadOnlyDictionary<string, long> TestDictStrInt(IReadOnlyDictionary<string, long> a);

    /// <summary>
    /// Invokes the Python function <c>test_dict_str_list_int</c>:
    /// <code><![CDATA[
    /// def test_dict_str_list_int(a: dict[str, list[int]]) -> dict[str, list[int]]: ...
    /// ]]></code>
    /// </summary>
    IReadOnlyDictionary<string, IReadOnlyList<long>> TestDictStrListInt(IReadOnlyDictionary<string, IReadOnlyList<long>> a);

    /// <summary>
    /// Invokes the Python function <c>test_dict_str_dict_int</c>:
    /// <code><![CDATA[
    /// def test_dict_str_dict_int(a: dict[str, dict[str, int]]) -> dict[str, dict[str, int]]: ...
    /// ]]></code>
    /// </summary>
    IReadOnlyDictionary<string, IReadOnlyDictionary<string, long>> TestDictStrDictInt(IReadOnlyDictionary<string, IReadOnlyDictionary<string, long>> a);

    /// <summary>
    /// Invokes the Python function <c>test_mapping</c>:
    /// <code><![CDATA[
    /// def test_mapping(a: Mapping[str, int]) -> Mapping[str, int]: ...
    /// ]]></code>
    /// </summary>
    IReadOnlyDictionary<string, long> TestMapping(IReadOnlyDictionary<string, long> a);
}
